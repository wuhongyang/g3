<?php
header("Content-type: text/html; charset=utf-8");
require_once '../library/global.fun.php';

$db = domain::main()->GroupDBConn('mysql');

$zhanzhang=array(5510000,5120000,5711238,5712249,20228318,5711338,5710308,5510208,5910108,20227844,20139212,5121348,4111018,5711268,5710968,20228656,20228669);
$others=array(5510118,5510439,5510628,5510638,5510659,5510739,5510779,5510889,5511269,5511279,5511289,5712109,20226125,20226175,20227013,5121158,5121688,20226160,20227897,5120419,5120479,5122219,4110959,5122479,5122639,5122689,20225894,20226076,20226161,20226163,20226172,20226179,20226427,20198300,20227994,20228112,5711979,5712099,20123744,20224138,20224332,20224333,20224334,20225891,20225926,20226070,20226352,20227951,20228324,20228363,20228513,5710319,5711139,5711149,5711219,5712059,5712249,20140780,20228369,20228424,20228426,20228427,20228435,20228454,20228456,20120709,20168401,5712129,5510309,5510509,5510589,4110968,5122529,5122539,5122659,5122669,5916669,20225856,20225905,20226775,20120529,20121272,20203830,5910749,4111049,4111079,4111089,4111099);
$others_key=array(5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5510000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5120000,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5711238,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5712249,5711338,5710308,5710308,5510208,5510208,5510208,5910108,5910108,5910108,5910108,5910108,5910108,5910108,5910108,5910108,20139212,20139212,5121348,5121348,4111018,4111018,4111018,4111018);

$error=array();

foreach($zhanzhang as $val){
	$sql='UPDATE kexoo_im.sso_user_relate SET group_id='.$val.',is_use=1 WHERE uin='.$val;
	if(!$db->query($sql)){
		$error[]=$val.'更新mysql失败';
	}
}
for($i=0;$i<count($others);$i++){
	$sql='UPDATE kexoo_im.sso_user_relate SET group_id='.$others_key[$i].',is_use=1 WHERE uin='.$others[$i];
	if(!$db->query($sql)){
		$error[]=$others[$i].'更新mysql失败';
	}
}

/* foreach($zhanzhang as $val){
	$roleData=array(
		'extparam'=>array(
			'Tag'=>'AddGroupRole',
			'GroupId'=>$val,
			'Uin'=>$val,
			'RoleId'=>10126,
			'RoomId'=>0
		)
	);
	$res=httpPOST(ROLE_API_PATH,$roleData);
	if($res['Flag']!=100){
		$error[]=$val.'更新mongo失败，失败原因为：'.$res['Flag'].','.$res['FlagString'];
	}
}
for($i=0;$i<count($others);$i++){
	$roleData=array(
		'extparam'=>array(
			'Tag'=>'AddGroupRole',
			'GroupId'=>$others_key[$i],
			'Uin'=>$others[$i],
			'RoleId'=>10126,
			'RoomId'=>0
		)
	);
	$res=httpPOST(ROLE_API_PATH,$roleData);
	if($res['Flag']!=100){
		$error[]=$others[$i].'更新mongo失败，失败原因为：'.$res['Flag'].','.$res['FlagString'];
	}
} */

if(empty($error)){
	echo '执行完毕，所有数据更新成功';
}
else{
	echo '执行完毕，以下数据更新失败：';
	foreach($error as $val){
		echo '<br />'.$val;
	}
}
exit;
